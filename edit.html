<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NMD Accountancy</title>
<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Include jsPDF and AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<style>
body { font-family: Inter, Segoe UI, Roboto, Arial; margin: 0; background-color: #0a0f0d; color: #e0f2f1; }
/* Sidebar */
.sidebar { position: fixed; left: 0; top: 0; width: 220px; height: 100%; background-color: #123822; padding-top: 20px; display: flex; flex-direction: column; transition: width 0.3s; overflow: hidden; }
.sidebar.collapsed { width: 60px; }
.sidebar .logo { width: 120px; margin: 20px; margin-left: 60px; transition: width 0.3s, margin 0.3s; }
.sidebar.collapsed .logo { margin-left: 10px; }
.sidebar .logo img { width: 70%; border-radius: 100%; border: solid; border-color: aquamarine; }
.sidebar.collapsed .logo img { width: 30%; }
.sidebar a { padding: 15px 20px; text-decoration: none; color: #e0f2f1; display: flex; align-items: center; gap: 10px; transition: 0.3s; font-weight: 500; }
.sidebar.collapsed a span.text { display: none; }
.sidebar a svg { width: 20px; height: 20px; fill: #e0f2f1; }
.sidebar a:hover { background-color: #2e7d60; }
.sidebar a.active { background-color: #1b5e43; }
/* Sidebar toggle button */
#sidebarToggle { cursor: pointer; color: #a8e6cf; font-size: 1.5rem; text-align: center; margin-bottom: 20px; transition: transform 0.3s; }
#sidebarToggle.collapsed { transform: rotate(180deg); }
/* Main content */
/* Main Content Styling */
.main-content { margin-left: 220px; /* Adjust according to sidebar */ padding: 30px 40px; transition: margin-left 0.3s; background-color: #0a0f0d; min-height: 100vh; }
.sidebar.collapsed ~ .main-content { margin-left: 60px;}
/* Top Bar */
#topBar { display: flex; justify-content: flex-end; align-items: center; gap: 20px; margin-bottom: 30px; font-weight: 500; color: #a8e6cf; font-size: 0.95rem;}
/* Headings */ 
.main-content h1 { color: #a8e6cf; text-align: left; }
/* Filter container */ 
#savedInvoicesFilters { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; align-items: center; }
/* Inputs and selects */ 
#savedInvoicesFilters input[type="text"], #savedInvoicesFilters input[type="date"], #savedInvoicesFilters select { padding: 6px 10px; border-radius: 4px; border: 1px solid #2e7d60; background-color: #0a0f0d; color: #e0f2f1; font-size: 0.9rem; width: 130px; }
#savedInvoicesFilters select { width: 150px; }
#savedInvoicesFilters input[type="text"] { width: 240px; }
/* Focus style */ 
#savedInvoicesFilters input:focus, #savedInvoicesFilters select:focus { outline: none; border-color: #a8e6cf; }
/* Clear button */ 
#savedInvoicesFilters button#clearFilters { background-color: #2e7d60; color: white; padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem; transition: background 0.3s; }
#savedInvoicesFilters button#clearFilters:hover { background-color: #1d4b3a; }
/* Change calendar icon color */ 
input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(48%) sepia(82%) saturate(550%) hue-rotate(90deg); cursor: pointer; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; } table th, table td { border:1px solid #1b5e36; padding:8px; text-align:left; } table th { background-color:#2e7d60; } button { padding: 5px 10px; border-radius: 4px; border: none; cursor: pointer; margin-right: 5px; } .edit { background-color: #2e7d60; color: white; } .edit:hover{ background-color: #1d4b3a; } .delete { background-color: #b23b3b; color: white; } .delete:hover{ background-color: #7f1d1d; }
/* Grid layout for edit form */ 
#editForm { display: none; margin-top: 20px; padding: 15px; background: #123822; border-radius: 8px; } #editForm .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px 20px; } #editForm label { font-weight: 600; margin-bottom: 5px; display: block; color: #a8e6cf; } #editForm input, #editForm select { width: 90%; padding: 8px; border: 1px solid #2e7d60; border-radius: 4px; background: #0a0f0d; color: #e0f2f1; }
#addEditLine { background-color: #2e7d60; color: #fff; border: none; border-radius: 6px; padding: 8px 16px; font-size: 14px; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease, transform 0.1s ease; margin: 10px; }
#addEditLine:hover { background-color: #1d4b3a; }
/* Common buttons */ 
#saveChanges, #cancelEdit { border: none; border-radius: 6px; padding: 10px 18px; font-size: 14px; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease, transform 0.1s ease; margin-right: 8px; }
#saveChanges { background-color: #2e7d60; color: #fff; } #saveChanges:hover { background-color: #1d4b3a; }
#cancelEdit { background-color: #b23b3b; color: #fff; } #cancelEdit:hover { background-color: #7f1d1d; }
.deleteLine { background-color: #b23b3b; color: #fff; } .deleteLine:hover { background-color: #7f1d1d; }
.download, .view { background-color: #2e7d60; color: white; }
.download:hover, .view:hover{ background-color: #143328; color: white;}
.print { background-color: #3b6db2; color: white; }
.print:hover { background-color: #1d3556; color: white; }
/* Items Table */ 
#editItemsTable th { background-color:#2e7d60; } #editItemsTable td input { width: 95%; background:#123822; color:#e0f2f1; border:1px solid #1b5e36; border-radius:4px; padding:5px; } .preview-box { margin-top: 20px; padding: 15px; border: 1px solid #1b5e36; background: #123822; border-radius: 8px; }
.invoice-preview { font-family: Inter, Segoe UI, Roboto, Arial; background: #fff; color: #111; padding: 15mm 15mm; border-radius: 12px; width: 190mm; max-width: 100%; margin: 10mm auto; box-sizing: border-box; box-shadow: 0 6px 18px rgba(2,6,23,0.1); } .invoice-title { font-size: 28px; font-weight:700; text-align:left; margin-bottom:20px; margin-top:80px; } .invoice-info { display:flex; justify-content:space-between; flex-wrap:wrap; margin-bottom:15px; gap:10px; } .invoice-to, .invoice-details { flex:1; min-width:180px; } #linesTable { width:100%; border-collapse:collapse; margin-bottom:10px; font-size:12px; } #linesTable th, #linesTable td { border:1px solid #ddd; padding:6px 5px; text-align:left; } #linesTable th { background:#2e7d60; color:#fff; font-weight:600; } #linesTable td.right { text-align:right; } .invoice-bottom { display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; } .invoice-left { flex:1; min-width:180px; } .invoice-thanks { margin-bottom:8px; } .thanks-title {font-weight:700; font-size:18px; margin-bottom:8px;} .payment-title { font-weight:700; font-size:14px; margin-bottom:4px; } .payment-text, .bank-details, .cheque-payment1 { font-size:12px; line-height:1.2; color:#333; } .invoice-totals { flex:1; min-width:150px; display:flex; flex-direction:column; gap:5px; } .invoice-totals > div { display:flex; justify-content:space-between; font-weight:500; font-size:12px; padding:4px 6px; } .final-amount { font-weight:700; font-size:14px; background:#616363; color:#fff; padding:4px 6px; border-radius:4px; } .cheque-payment { margin-top:10px; } .invoice-footer { margin-top:50px; font-size:10px; color:#555; text-align:center; }
@media print { body{ margin:0;  color:#000; } .invoice-preview { box-shadow:none; border-radius:0; width:190mm; padding:15mm; margin:0 auto; page-break-inside:avoid; } #linesTable th, #linesTable td { padding:5px 4px; font-size:11px; } .invoice-totals > div { font-size:11px; } .payment-text, .bank-details, .cheque-payment1 { font-size:11px; } .invoice-footer { font-size:9px; } #linesTable tr { page-break-inside:avoid; } }
@media screen and (max-width: 768px) { .sidebar { width: 60px; } .sidebar.collapsed { width: 60px; } .sidebar .logo { margin-left: 10px; width: 80px; } .sidebar .logo img { width: 40%; } .sidebar a span.text { display: none; } .main-content { margin-left: 60px; padding: 15px; } #topBar { flex-wrap: wrap; font-size: 0.85rem; gap: 10px; } .main-content h1 { font-size: 1.4rem; text-align: center; } #savedInvoicesFilters { flex-direction: column; align-items: stretch; gap: 10px; } #savedInvoicesFilters input[type="text"], #savedInvoicesFilters input[type="date"], #savedInvoicesFilters select { width: 100%; } #savedInvoicesFilters button#clearFilters { width: 100%; } #editForm .form-grid { grid-template-columns: 1fr; gap: 10px; } #addEditLine, #saveChanges, #cancelEdit { width: 100%; margin: 5px 0; } table, #editItemsTable { display: block; overflow-x: auto; font-size: 0.85rem; } table th, table td, #editItemsTable td input { padding: 6px; } button.edit, button.delete, .deleteLine { width: 100%; margin: 5px 0; font-size: 0.85rem; } }
@media screen and (max-width: 1024px) { .main-content { padding: 25px 30px; } .main-content h1 { font-size: 1.75rem; text-align: center; } #savedInvoicesFilters input[type="text"], #savedInvoicesFilters input[type="date"], #savedInvoicesFilters select { width: 95%; } #editForm .form-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); } #addEditLine, #saveChanges, #cancelEdit { padding: 8px 14px; font-size: 13px; } table, #editItemsTable { font-size: 0.9rem; } button.edit, button.delete, .deleteLine { padding: 6px 10px; font-size: 0.9rem; } }
@media screen and (max-width: 480px) { .main-content { padding: 10px 15px; } .main-content h1 { font-size: 1.3rem; } #savedInvoicesFilters { flex-direction: column; align-items: stretch; gap: 8px; } #savedInvoicesFilters input[type="text"], #savedInvoicesFilters input[type="date"], #savedInvoicesFilters select, #savedInvoicesFilters button#clearFilters { width: 90%; font-size: 0.85rem; } #editForm .form-grid { grid-template-columns: 1fr; gap: 8px; } #addEditLine, #saveChanges, #cancelEdit { width: 100%; margin: 5px 0; font-size: 0.85rem; } table, #editItemsTable { font-size: 0.8rem; display: block; overflow-x: auto; } table th, table td, #editItemsTable td input { padding: 5px; } button.edit, button.delete, .deleteLine { width: 100%; margin: 5px 0; font-size: 0.8rem; } }
/*#savedInvoices th {  text-align: center;}*/
/* Adjust each column width */
#savedInvoices th:nth-child(1), #savedInvoices td:nth-child(1) { width: 15%;  /* Date */}
#savedInvoices th:nth-child(2), #savedInvoices td:nth-child(2) { width: 20%;  /* Number */}
#savedInvoices th:nth-child(3), #savedInvoices td:nth-child(3) { width: 10%;  /* Type */}
#savedInvoices th:nth-child(4), #savedInvoices td:nth-child(4) { width: 20%;  /* Client */ }
#savedInvoices th:nth-child(5), #savedInvoices td:nth-child(5) { width: 35%;  /* Action */}

/* Responsive adjustments */
@media screen and (max-width: 768px) {
    td button {
        font-size: 0.8rem;
        padding: 5px 8px;
        min-width: 50px;
    }
}

@media screen and (max-width: 480px) {
    td {
        flex-direction: column; /* stack buttons vertically */
        align-items: stretch;
    }
    td button {
        width: 100%; /* full width on very small screens */
        text-align: center;
        padding: 6px 0;
        font-size: 0.75rem;
        min-width: unset;
    }
}

</style>
</head>
<body>

<div class="sidebar">
    <div id="sidebarToggle">◀</div>
    <div class="logo">
        <img src="invoice.jpg" alt="NMD Accountancy Logo">
    </div>
    <a href="dashboard.html" id="navDashboard">
        <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8v-10h-8v10zm0-18v6h8V3h-8z"/></svg>
        <span class="text">Dashboard</span>
    </a>
    <a href="clients.html">
        <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4S14.21 4 12 4 8 5.79 8 8s1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
        <span class="text">Add Clients</span>
    </a>
    <a href="invoice.html" id="navCreate">
        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2V5a2 2 0 00-2-2zm-7 14H7v-2h5v2zm5-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
        <span class="text">Create Invoice</span>
    </a>
    <a href="edit.html" id="navSaved">
        <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
        <span class="text">Manage Invoices</span>
    </a>
    <a href="cover.html" id="navDownload">
        <svg viewBox="0 0 24 24" width="24" height="24"> <path d="M19 8H5c-1.1 0-2 .9-2 2v6h4v4h10v-4h4v-6c0-1.1-.9-2-2-2zm-1 8H6v-5h12v5zm-5-9h-2V3h2v4z"/></svg>
        <span class="text">Cover Page</span>
    </a>
    <a href="#" id="navLogout">
        <svg viewBox="0 0 24 24"><path d="M16 13v-2H7V7l-5 5 5 5v-4h9zm3-10H5c-1.1 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>
        <span class="text">Logout</span>
    </a>
</div>

<div class="main-content">
    <div id="topBar">
        <span id="adminName">Admin: NMD Accountancy</span>
        <span id="systemDateTime"></span>
    </div>
<h1>Manage Invoices</h1>

<!-- Add this search/filter section inside main-content, above your table -->
<div id="savedInvoicesFilters">
    <input type="text" id="searchText" placeholder="Search by number or client">
    <select id="filterType">
        <option value="">All</option>
        <option value="INV">Invoice</option>
        <option value="QT">Quotation</option>
    </select>
    From: <input type="date" id="filterDateFrom">
    To: <input type="date" id="filterDateTo">
    <button id="clearFilters">Clear</button>
</div>

<table id="savedInvoices">
    <thead>
        <tr>
            <th>Date</th>
            <th>Number</th>
            <th>Type</th>
            <th>Client</th>
            
            <th>Action</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<!-- Edit form -->
<div id="editForm">
    <h2>Edit Invoice</h2>
    <input type="hidden" id="editIndex">

    <div class="form-grid">
        <div>
            <label>Invoice Number</label>
            <input type="text" id="editNumber" readonly>
        </div>

        <div>
            <label>Type</label>
            <select id="editType" disabled>
                <option value="INV">Invoice</option>
                <option value="QT">Quotation</option>
            </select>
        </div>

        <div>
            <label>Date</label>
            <input type="date" id="editDate" readonly>
        </div>

        <div>
            <label>Client</label>
            <input type="text" id="editClient">
        </div>

        <div>
            <label>Contact</label>
            <input type="text" id="editContact">
        </div>

        <div>
            <label>Location</label>
            <input type="text" id="editLocation">
        </div>

        <div>
    <label>Discount (%)</label>
    <input type="number" id="editDiscount" value="0" min="0" max="100" step="0.01">
</div>
</div>

    <h3>Items</h3>
    <table id="editItemsTable">
        <thead>
            <tr>
                <th>#</th>
                <th>Description</th>
                <th>Qty</th>
                <th>Unit Price</th>
                <th>Line Total</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <button type="button" id="addEditLine">Add Line</button>

    <h3>Invoice Preview</h3>
    <div id="editInvoicePreview" class="preview-box">
        <p>No preview yet.</p>
    </div>

    <br>
    <button id="saveChanges" >Save Changes</button>
    <button id="cancelEdit">Cancel</button>
</div>
</div>

<!-- Watermark Footer -->
<div style="position: fixed; bottom: 0; right: 0; width: 100%; text-align: right; 
            font-size: 12px; color: rgba(255,255,255,0.2); padding: 5px 20px; 
            pointer-events: none; user-select: none; z-index: 9999;">
    &copy; Developed by Grow More Solutions Pvt Ltd
</div>

<script>

// ------------------------------
// LOGIN CHECK
// ------------------------------
if(localStorage.getItem('isLoggedIn') !== 'true'){
    alert('Please login first!');
    window.location.href = 'index.html';
}

// ------------------------------
// FORMAT NUMBER / CURRENCY
// ------------------------------
function formatNumber(num){ return parseFloat(num).toFixed(2); }
function formatCurrency(num){ return formatNumber(num); } // Can adapt to LKR formatting

// ------------------------------
// RENDER SAVED INVOICES
// ------------------------------
function renderInvoices(){
    const tbody = document.querySelector("#savedInvoices tbody");
    tbody.innerHTML = '';
    let invoices = JSON.parse(localStorage.getItem('invoices')||'[]');

    // Get filter values
    const searchText = document.getElementById("searchText")?.value.trim().toLowerCase() || '';
    const filterType = document.getElementById("filterType")?.value || '';
    const filterFrom = document.getElementById("filterDateFrom")?.value || '';
    const filterTo = document.getElementById("filterDateTo")?.value || '';

    // Apply filters
    invoices = invoices.filter(inv => {
        let matchesText = inv.number.toLowerCase().includes(searchText) || inv.client.toLowerCase().includes(searchText);
        let matchesType = filterType ? inv.type === filterType : true;
        let matchesDate = true;
        if(filterFrom) matchesDate = inv.date >= filterFrom;
        if(filterTo) matchesDate = matchesDate && inv.date <= filterTo;
        return matchesText && matchesType && matchesDate;
    });

    invoices.forEach((inv,i)=>{
        const tr = document.createElement("tr");

        function highlightText(text){
            if(!searchText) return text;
            const regex = new RegExp(`(${searchText})`, "gi");
            return text.replace(regex, "<mark style='background:yellow;color:black;'>$1</mark>");
        }

        tr.innerHTML = `
            <td>${inv.date}</td>
            <td>${highlightText(inv.number)}</td>
            <td>${inv.type}</td>
            <td>${highlightText(inv.client)}</td>
            <td>
                <button class="view">View</button>
                <button class="edit">Edit</button>
                
                <button class="download">PDF</button>
                <button class="print">Print</button>
                <button class="delete">Delete</button>
            </td>`;
        tbody.appendChild(tr);
        tr.querySelector(".download").addEventListener("click", ()=> generatePDF(inv));
        tr.querySelector(".print").addEventListener("click", ()=> printInvoice(inv));
        tr.querySelector(".view").addEventListener("click", ()=> viewInvoice(inv));
        tr.querySelector(".edit").addEventListener("click", ()=>{ showEditForm(inv, i); });
        tr.querySelector(".delete").addEventListener("click", ()=>{
            if(confirm("Delete this invoice?")){
                let allInvoices = JSON.parse(localStorage.getItem('invoices')||'[]');
                allInvoices.splice(i,1);
                localStorage.setItem('invoices', JSON.stringify(allInvoices));
                renderInvoices();
            }
        });
    });
}
renderInvoices();

// Filter event listeners
["searchText","filterType","filterDateFrom","filterDateTo"].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.addEventListener("input", renderInvoices);
});
document.getElementById("clearFilters").addEventListener("click", ()=>{
    document.getElementById("searchText").value = "";
    document.getElementById("filterType").value = "";
    document.getElementById("filterDateFrom").value = "";
    document.getElementById("filterDateTo").value = "";
    renderInvoices();
});

// ------------------------------
// GET INVOICE HTML (PRINT STYLE)
// ------------------------------
function getInvoiceHTML(inv){
    let subtotal = inv.items.reduce((sum,it)=>sum + it.lineTotal,0);
    let discount = inv.discount || 0;
    let discountAmount = subtotal * (discount/100);
    let finalAmount = subtotal - discountAmount;

    let rows = inv.items.map((it,i)=>`
        <tr>
            <td style="width:5%; text-align:center;">${i+1}</td>
            <td style="width:50%">${it.description}</td>
            <td style="width:10%; text-align:center;">${it.qty}</td>
            <td style="width:15%; text-align:right;">${formatCurrency(it.price)}</td>
            <td style="width:20%; text-align:right;">${formatCurrency(it.lineTotal)}</td>
        </tr>`).join('');

    return `
    <div class="invoice-preview">
        <div class="invoice-title">${inv.type === 'QT' ? 'QUOTATION' : 'INVOICE'}</div>
        <div class="invoice-info">
            <div class="invoice-to">
                <div><strong>To:</strong></div>
                <div>Name: ${inv.client}</div>
                <div>Contact: ${inv.contact}</div>
                <div>Address: ${inv.location}</div>
            </div>
            <div class="invoice-details">
                <div><strong>Invoice No:</strong> ${inv.number}</div>
                <div><strong>Invoice Date:</strong> ${inv.date}</div>
            </div>
        </div>
        <table id="linesTable">
            <thead>
                <tr>
                    <th style="width:5%; text-align:center;">#</th>
                    <th style="width:47%; text-align:center;">Description</th>
                    <th style="width:10%; text-align:center;">QTY</th>
                    <th style="width:18%; text-align:center;">Unit Price (LKR)</th>
                    <th style="width:20%; text-align:center;">Total</th>
                </tr>
            </thead>
            <tbody>${rows}</tbody>
        </table>
        <div class="invoice-bottom">
            <div class="invoice-left">
                <div class="invoice-thanks">
                    <div class="thanks-title">Thank You for your Business</div>
                    <div class="payment-title">Payment Instructions</div>
                    <div class="payment-text">
                        Please make the payment to the bank details provided below.
                        If you have any questions or need additional information, please contact us at 0777178196.
                    </div>
                </div>
                <div class="bank-details">
                    <div class="payment-title">Bank Details</div>
                    Bank Name: Commercial Bank<br>
                    Account Name: Neranjala Sekar<br>
                    Account Number: 8240009545<br>
                    Bank Branch: Pettah Branch<br>
                </div>
            </div>
            <div class="invoice-totals">
                <div class="subtotal"><div>Subtotal</div><div>LKR ${formatCurrency(subtotal)}</div></div>
                <div class="discount"><div>Discount (${discount}%)</div><div>LKR ${formatCurrency(discountAmount)}</div></div>
                <div class="final-amount"><div>Total</div><div>LKR ${formatCurrency(finalAmount)}</div></div>
            </div>
        </div>
        <div class="cheque-payment">
            <div class="payment-title">Cheque Payment</div>
            <div class="cheque-payment1">Please make the cheque payable to: NMD Accountancy</div>
        </div>
        <div class="invoice-footer">
            If you have any questions about this invoice, please contact <b>nmdacc2018@gmail.com</b> or <b>0777178196</b>
        </div>
    </div>`;
}

function viewInvoice(inv){
    const w = window.open('', '', 'height=900,width=800');
    const css = `
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
           .invoice-preview {
      font-family: Inter, Segoe UI, Roboto, Arial;
      background: #fff;
      color: #111;
      padding: 15mm 15mm;
      border-radius: 12px;
      width: 190mm;
      max-width: 100%;
      margin: 10mm auto;
      box-sizing: border-box;
      box-shadow: 0 6px 18px rgba(2,6,23,0.1);
    }
    .invoice-title { font-size: 28px; font-weight:700; text-align:left; margin-bottom:20px; margin-top:80px; }
    .invoice-info { display:flex; justify-content:space-between; flex-wrap:wrap; margin-bottom:15px; gap:10px; }
    .invoice-to, .invoice-details { flex:1; min-width:180px; }

    /* --- Table Styling --- */
    #linesTable { 
        width:100%; 
        margin: 0 auto 10px auto; /* center the table */
        border-collapse:collapse; 
        font-size:12px; 
    }
    #linesTable th, #linesTable td { 
        border:1px solid #ddd; 
        padding:6px 5px; 
    }
    #linesTable th { 
        background:#2e7d60; 
        color:#fff; 
        font-weight:600; 
    }
    #linesTable td.right { text-align:right; }
    #linesTable td.center, #linesTable th.center { text-align:center; }

    /* --- Invoice Layout --- */
    .invoice-bottom { display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; }
    .invoice-left { flex:1; min-width:180px; }
    .invoice-thanks { margin-bottom:8px; }
    .thanks-title {font-weight:700; font-size:18px; margin-bottom:8px;}
    .payment-title { font-weight:700; font-size:14px; margin-bottom:4px; }
    .payment-text, .bank-details, .cheque-payment1 { font-size:12px; line-height:1.2; color:#333; }
    .invoice-totals { flex:1; min-width:150px; display:flex; flex-direction:column; gap:5px; }
    .invoice-totals > div { display:flex; justify-content:space-between; font-weight:500; font-size:12px; padding:4px 6px; }
    .final-amount { font-weight:700; font-size:14px; background:#616363; color:#fff; padding:4px 6px; border-radius:4px; }
    .cheque-payment { margin-top:10px; }
    .invoice-footer { margin-top:50px; font-size:10px; color:#555; text-align:center; }

    @media print {
      body{ margin:0; -webkit-print-color-adjust:exact; color:#000; }
      .invoice-preview { box-shadow:none; border-radius:0; width:190mm; padding:15mm; margin:0 auto; page-break-inside:avoid; }
      #linesTable th, #linesTable td { padding:5px 4px; font-size:11px; }
      .invoice-totals > div { font-size:11px; }
      .payment-text, .bank-details, .cheque-payment1 { font-size:11px; }
      .invoice-footer { font-size:9px; }
      #linesTable tr { page-break-inside:avoid; }
    }
    </style>`;

    w.document.write(css + getInvoiceHTML(inv));
    w.document.close();
    w.focus();
}


// ------------------------------
// SHOW EDIT FORM
// ------------------------------
function showEditForm(inv, index){
    document.getElementById("editForm").style.display = "block";
    document.getElementById("editIndex").value = index;
    document.getElementById("editNumber").value = inv.number;
    document.getElementById("editType").value = inv.type;
    document.getElementById("editClient").value = inv.client;
    document.getElementById("editContact").value = inv.contact || "";
    document.getElementById("editLocation").value = inv.location || "";
    document.getElementById("editDate").value = inv.date;
    document.getElementById("editDiscount").value = inv.discount || 0;

    const tbodyItems = document.querySelector("#editItemsTable tbody");
    tbodyItems.innerHTML = '';
    inv.items.forEach(it=>{
        addEditLine(it.description, it.qty, it.price);
    });

    updateEditPreview();
}

// ------------------------------
// ADD/EDIT ITEM ROW
// ------------------------------
function addEditLine(desc='', qty=1, price=0){
    const tbody = document.querySelector("#editItemsTable tbody");
    const row = document.createElement("tr");
    row.innerHTML = `
        <td>${tbody.children.length+1}</td>
        <td><input type="text" value="${desc}" placeholder="Description"></td>
        <td><input type="number" value="${qty}" min="1"></td>
        <td><input type="number" value="${price}" min="0" step="0.01"></td>
        <td class="lineTotal">${formatNumber(qty*price)}</td>
        <td><button class="deleteLine">Delete</button></td>
    `;
    tbody.appendChild(row);

    const inputs = row.querySelectorAll("input");
    inputs.forEach(input=>{
        input.addEventListener("input", ()=>{
            const q = parseFloat(row.children[2].children[0].value)||0;
            const p = parseFloat(row.children[3].children[0].value)||0;
            row.children[4].textContent = formatNumber(q*p);
            updateEditPreview();
        });
    });

    row.querySelector(".deleteLine").addEventListener("click", ()=>{
        if(confirm("Are you sure you want to delete this item?")){
            row.remove();
            updateEditLineNumbers();
            updateEditPreview();
        }
    });

    updateEditPreview();
}

function updateEditLineNumbers(){
    const rows = document.querySelectorAll("#editItemsTable tbody tr");
    rows.forEach((row,i)=>{ row.children[0].textContent = i+1; });
}

// ------------------------------
// UPDATE EDIT PREVIEW
// ------------------------------
function updateEditPreview(){
    const number = document.getElementById("editNumber").value;
    const type = document.getElementById("editType").value;
    const client = document.getElementById("editClient").value;
    const contact = document.getElementById("editContact").value;
    const location = document.getElementById("editLocation").value;
    const date = document.getElementById("editDate").value;
    const discount = parseFloat(document.getElementById("editDiscount").value)||0;

    const rows = document.querySelectorAll("#editItemsTable tbody tr");
    const items = Array.from(rows).map(r=>({
        description: r.children[1].children[0].value,
        qty: parseFloat(r.children[2].children[0].value)||0,
        price: parseFloat(r.children[3].children[0].value)||0,
        lineTotal: parseFloat(r.children[4].textContent)||0
    }));

    if(items.length === 0){
        document.getElementById("editInvoicePreview").innerHTML = "<p>No preview yet.</p>";
        return;
    }

    const invoice = { number, type, client, contact, location, date, discount, items };
    document.getElementById("editInvoicePreview").innerHTML = `
        <div style="max-height:400px; overflow:auto;">
            ${getInvoiceHTML(invoice)}
        </div>`;
}

// ------------------------------
// SAVE CHANGES
// ------------------------------
document.getElementById("saveChanges").addEventListener("click", ()=>{
    if(!confirm("Are you sure you want to save the changes?")) return;

    const index = document.getElementById("editIndex").value;
    let invoices = JSON.parse(localStorage.getItem('invoices')||'[]');

    invoices[index].type = document.getElementById("editType").value;
    invoices[index].client = document.getElementById("editClient").value.trim();
    invoices[index].contact = document.getElementById("editContact").value.trim();
    invoices[index].location = document.getElementById("editLocation").value.trim();
    invoices[index].date = document.getElementById("editDate").value;

    const rows = document.querySelectorAll("#editItemsTable tbody tr");
    invoices[index].items = Array.from(rows).map(r=>({
        description: r.children[1].children[0].value,
        qty: parseFloat(r.children[2].children[0].value)||0,
        price: parseFloat(r.children[3].children[0].value)||0,
        lineTotal: parseFloat(r.children[4].textContent)||0
    }));

    const discount = parseFloat(document.getElementById("editDiscount").value)||0;
    const subtotal = invoices[index].items.reduce((sum,it)=>sum+it.lineTotal,0);
    invoices[index].discount = discount;
    invoices[index].totalAfterDiscount = subtotal - subtotal*(discount/100);

    let clients = JSON.parse(localStorage.getItem('clients')||'[]');
    if(!clients.some(c=>c.name.toLowerCase()===invoices[index].client.toLowerCase())){
        clients.push({ name: invoices[index].client, contact: invoices[index].contact, location: invoices[index].location });
        localStorage.setItem('clients', JSON.stringify(clients));
    }

    localStorage.setItem('invoices', JSON.stringify(invoices));
    document.getElementById("editForm").style.display="none";
    renderInvoices();
});

// ------------------------------
// CANCEL EDIT
// ------------------------------
document.getElementById("cancelEdit").addEventListener("click", ()=>{ document.getElementById("editForm").style.display="none"; });

// Update preview on change
["editType","editClient","editContact","editLocation","editDate","editDiscount"].forEach(id=>{
    document.getElementById(id).addEventListener("input", updateEditPreview);
    document.getElementById(id).addEventListener("change", updateEditPreview);
});
document.getElementById("addEditLine").addEventListener("click", ()=> addEditLine());

// ------------------------------
// INVOICE HTML FOR PRINT PREVIEW
// ------------------------------
function getInvoiceHTML(inv){
    let subtotal = inv.items.reduce((sum,it)=>sum + it.lineTotal,0);
    let discount = inv.discount || 0; // in percentage
    let discountAmount = subtotal * (discount/100);
    let finalAmount = subtotal - discountAmount;

    let rows = inv.items.map((it,i)=>`
        <tr>
            <td style="width:5%; text-align:center;">${i+1}</td>
            <td style="width:50%">${it.description}</td>
            <td style="width:10%; text-align:center;">${it.qty}</td>
            <td style="width:15%; text-align:right;">${formatCurrency(it.price)}</td>
            <td style="width:20%; text-align:right;">${formatCurrency(it.lineTotal)}</td>
        </tr>`).join('');

    return `
    <div class="invoice-preview">
        <div class="invoice-title">${inv.type === 'QT' ? 'QUOTATION' : 'INVOICE'}</div>
        <div class="invoice-info">
            <div class="invoice-to">
                <div><strong>To:</strong></div>
                <div>Name: ${inv.client}</div>
                <div>Contact: ${inv.contact}</div>
                <div>Address: ${inv.location}</div>
            </div>
            <div class="invoice-details">
                <div><strong>Invoice No:</strong> ${inv.number}</div>
                <div><strong>Invoice Date:</strong> ${inv.date}</div>
            </div>
        </div>
        <table id="linesTable">
            <thead>
                <tr>
                    <th style="width:5%; text-align:center;">#</th>
                    <th style="width:47%; text-align:center;">Description</th>
                    <th style="width:10%; text-align:center;">QTY</th>
                    <th style="width:18%; text-align:center;">Unit Price (LKR)</th>
                    <th style="width:20%; text-align:center;">Total</th>
                </tr>
            </thead>
            <tbody>${rows}</tbody>
        </table>
        <div class="invoice-bottom">
            <div class="invoice-left">
                <div class="invoice-thanks">
                    <div class="thanks-title">Thank You for your Business</div>
                    <div class="payment-title">Payment Instructions</div>
                    <div class="payment-text">
                        Please make the payment to the bank details provided below.
                        If you have any questions or need additional information, please contact us at 0777178196.
                    </div>
                </div>
                <div class="bank-details">
                    <div class="payment-title">Bank Details</div>
                    Bank Name: Commercial Bank<br>
                    Account Name: Neranjala Sekar<br>
                    Account Number: 8240009545<br>
                    Bank Branch: Pettah Branch<br>
                </div>
            </div>
            <div class="invoice-totals">
                <div class="subtotal"><div>Subtotal</div><div>LKR ${formatCurrency(subtotal)}</div></div>
                <div class="discount"><div>Discount (${discount}%)</div><div>LKR ${formatCurrency(discountAmount)}</div></div>
                <div class="final-amount"><div>Total</div><div>LKR ${formatCurrency(finalAmount)}</div></div>
            </div>
        </div>
        <div class="cheque-payment">
            <div class="payment-title">Cheque Payment</div>
            <div class="cheque-payment1">Please make the cheque payable to: NMD Accountancy</div>
        </div>
        <div class="invoice-footer">
            If you have any questions about this invoice, please contact <b>nmdacc2018@gmail.com</b> or <b>0777178196</b>
        </div>
    </div>`;
}

// ------------------------------
// PRINT INVOICE
// ------------------------------
function printInvoice(inv){
    const w = window.open('', '', 'height=900,width=800');
    const css = `
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
           .invoice-preview {
      font-family: Inter, Segoe UI, Roboto, Arial;
      background: #fff;
      color: #111;
      padding: 15mm 15mm;
      border-radius: 12px;
      width: 190mm;
      max-width: 100%;
      margin: 10mm auto;
      box-sizing: border-box;
      box-shadow: 0 6px 18px rgba(2,6,23,0.1);
    }
    .invoice-title { font-size: 28px; font-weight:700; text-align:left; margin-bottom:20px; margin-top:80px; }
    .invoice-info { display:flex; justify-content:space-between; flex-wrap:wrap; margin-bottom:15px; gap:10px; }
    .invoice-to, .invoice-details { flex:1; min-width:180px; }

    /* --- Table Styling --- */
    #linesTable { 
        width:100%; 
        margin: 0 auto 10px auto; /* center the table */
        border-collapse:collapse; 
        font-size:12px; 
    }
    #linesTable th, #linesTable td { 
        border:1px solid #ddd; 
        padding:6px 5px; 
    }
    #linesTable th { 
        background:#2e7d60; 
        color:#fff; 
        font-weight:600; 
    }
    #linesTable td.right { text-align:right; }
    #linesTable td.center, #linesTable th.center { text-align:center; }

    /* --- Invoice Layout --- */
    .invoice-bottom { display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; }
    .invoice-left { flex:1; min-width:180px; }
    .invoice-thanks { margin-bottom:8px; }
    .thanks-title {font-weight:700; font-size:18px; margin-bottom:8px;}
    .payment-title { font-weight:700; font-size:14px; margin-bottom:4px; }
    .payment-text, .bank-details, .cheque-payment1 { font-size:12px; line-height:1.2; color:#333; }
    .invoice-totals { flex:1; min-width:150px; display:flex; flex-direction:column; gap:5px; }
    .invoice-totals > div { display:flex; justify-content:space-between; font-weight:500; font-size:12px; padding:4px 6px; }
    .final-amount { font-weight:700; font-size:14px; background:#616363; color:#fff; padding:4px 6px; border-radius:4px; }
    .cheque-payment { margin-top:10px; }
    .invoice-footer { margin-top:50px; font-size:10px; color:#555; text-align:center; }

    @media print {
      body{ margin:0; -webkit-print-color-adjust:exact; color:#000; }
      .invoice-preview { box-shadow:none; border-radius:0; width:190mm; padding:15mm; margin:0 auto; page-break-inside:avoid; }
      #linesTable th, #linesTable td { padding:5px 4px; font-size:11px; }
      .invoice-totals > div { font-size:11px; }
      .payment-text, .bank-details, .cheque-payment1 { font-size:11px; }
      .invoice-footer { font-size:9px; }
      #linesTable tr { page-break-inside:avoid; }
    }
    </style>`;

    w.document.write(css + getInvoiceHTML(inv));
    w.document.close();
    w.focus();
    w.print();
}

function viewInvoice(inv){
    const w = window.open('', '', 'height=900,width=800');
    const css = `

    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
           .invoice-preview {
      font-family: Inter, Segoe UI, Roboto, Arial;
      background: #fff;
      color: #111;
      padding: 15mm 15mm;
      border-radius: 12px;
      width: 190mm;
      max-width: 100%;
      margin: 10mm auto;
      box-sizing: border-box;
      box-shadow: 0 6px 18px rgba(2,6,23,0.1);
    }
    .invoice-title { font-size: 28px; font-weight:700; text-align:left; margin-bottom:20px; margin-top:80px; }
    .invoice-info { display:flex; justify-content:space-between; flex-wrap:wrap; margin-bottom:15px; gap:10px; }
    .invoice-to, .invoice-details { flex:1; min-width:180px; }

    /* --- Table Styling --- */
    #linesTable { 
        width:100%; 
        margin: 0 auto 10px auto; /* center the table */
        border-collapse:collapse; 
        font-size:12px; 
    }
    #linesTable th, #linesTable td { 
        border:1px solid #ddd; 
        padding:6px 5px; 
    }
    #linesTable th { 
        background:#2e7d60; 
        color:#fff; 
        font-weight:600; 
    }
    #linesTable td.right { text-align:right; }
    #linesTable td.center, #linesTable th.center { text-align:center; }

    /* --- Invoice Layout --- */
    .invoice-bottom { display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; }
    .invoice-left { flex:1; min-width:180px; }
    .invoice-thanks { margin-bottom:8px; }
    .thanks-title {font-weight:700; font-size:18px; margin-bottom:8px;}
    .payment-title { font-weight:700; font-size:14px; margin-bottom:4px; }
    .payment-text, .bank-details, .cheque-payment1 { font-size:12px; line-height:1.2; color:#333; }
    .invoice-totals { flex:1; min-width:150px; display:flex; flex-direction:column; gap:5px; }
    .invoice-totals > div { display:flex; justify-content:space-between; font-weight:500; font-size:12px; padding:4px 6px; }
    .final-amount { font-weight:700; font-size:14px; background:#616363; color:#fff; padding:4px 6px; border-radius:4px; }
    .cheque-payment { margin-top:10px; }
    .invoice-footer { margin-top:50px; font-size:10px; color:#555; text-align:center; }

    @media print {
      body{ margin:0; -webkit-print-color-adjust:exact; color:#000; }
      .invoice-preview { box-shadow:none; border-radius:0; width:190mm; padding:15mm; margin:0 auto; page-break-inside:avoid; }
      #linesTable th, #linesTable td { padding:5px 4px; font-size:11px; }
      .invoice-totals > div { font-size:11px; }
      .payment-text, .bank-details, .cheque-payment1 { font-size:11px; }
      .invoice-footer { font-size:9px; }
      #linesTable tr { page-break-inside:avoid; }
    }
    </style>`;

    w.document.write(css + getInvoiceHTML(inv));
    w.document.close();
    w.focus();
}

// ------------------------------
// GENERATE PDF
// ------------------------------
function generatePDF(inv) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF("p", "mm", "a4");
    const pageWidth = doc.internal.pageSize.getWidth();
    const pageHeight = doc.internal.pageSize.getHeight();
    const margin = 25.4; // 1 inch margin

    if (window.invoiceBgBase64) {
        doc.addImage(window.invoiceBgBase64, "JPEG", 0, 0, pageWidth, pageHeight);
    }

    // Invoice Info
    doc.setFont("helvetica", "bold");
    doc.setFontSize(22);
    doc.text(inv.type === 'QT' ? "QUOTATION" : "INVOICE", 15, 25);

    doc.setFont("helvetica", "normal");
    doc.setFontSize(11);
    let yLeft = 40;
    doc.text(`To:`, 15, yLeft);
    yLeft += 7; doc.text(`Name: ${inv.client}`, 15, yLeft);
    yLeft += 7; doc.text(`Contact: ${inv.contact}`, 15, yLeft);
    yLeft += 7; doc.text(`Address: ${inv.location}`, 15, yLeft);

let yRight = 40;
const rightX = pageWidth - 80;

// Invoice No
doc.setFont("helvetica", "bold");
doc.text("Invoice No:", rightX, yRight);
doc.setFont("helvetica", "normal");
doc.text(`${inv.number}`, rightX + 30, yRight); // 30mm offset for value
yRight += 7;

// Invoice Date
doc.setFont("helvetica", "bold");
doc.text("Invoice Date:", rightX, yRight);
doc.setFont("helvetica", "normal");
doc.text(`${inv.date}`, rightX + 30, yRight); // same offset


    let y = Math.max(yLeft, yRight) + 10;

    const rows = inv.items.map((it, i) => [
        i + 1,
        it.description,
        it.qty,
        formatCurrency(it.price),
        formatCurrency(it.lineTotal)
    ]);

    doc.autoTable({
        startY: y,
        head: [["#", "Description", "QTY", "Unit Price (LKR)", "Total"]],
        body: rows,
        theme: "grid",
        headStyles: { fillColor: [46, 125, 96], textColor: 255, fontStyle: "bold", halign: "center" },
        styles: { fontSize: 10, cellPadding: 3 },
        columnStyles: { 0:{cellWidth:10},1:{cellWidth:80},2:{cellWidth:20, halign:"center"},3:{cellWidth:35, halign:"right"},4:{cellWidth:35, halign:"right"} }
    });

    let finalY = doc.lastAutoTable.finalY + 10;

    // Bottom Section
    doc.setFont("helvetica", "bold"); doc.setFontSize(14);
    doc.text("Thank You for your Business", 15, finalY);
    finalY += 7; doc.setFontSize(12); doc.text("Payment Instructions", 15, finalY);
    doc.setFont("helvetica", "normal"); doc.setFontSize(10);
    finalY += 6;
    doc.text("Please make the payment to the bank details provided below.\nIf you have any questions, please contact us at 0777178196.", 15, finalY);
    finalY += 15;
    doc.setFont("helvetica", "bold"); doc.setFontSize(12); doc.text("Bank Details", 15, finalY);
    doc.setFont("helvetica", "normal"); doc.setFontSize(10); finalY += 6;
    doc.text("Bank Name: Commercial Bank\nAccount Name: Neranjala Sekar\nAccount Number: 8240009545\nBank Branch: Pettah Branch", 15, finalY);

    // Totals with discount
    const subtotal = inv.items.reduce((s,it)=>s+it.lineTotal,0);
    const discount = inv.discount || 0;
    const discountAmount = subtotal*(discount/100);
    const finalAmount = subtotal - discountAmount;

   const totalsX = pageWidth - 90;
let totalsY = doc.lastAutoTable.finalY + 10;

doc.text("Subtotal:", totalsX, totalsY);
doc.text(`LKR ${formatCurrency(subtotal)}`, totalsX + 72, totalsY, { align: "right" }); // moved left
totalsY += 7;

doc.text(`Discount (${discount}%):`, totalsX, totalsY);
doc.text(`LKR ${formatCurrency(discountAmount)}`, totalsX + 72, totalsY, { align: "right" }); // moved left
totalsY += 7;

doc.setFont("helvetica", "bold"); 
doc.setFontSize(12); 
doc.setFillColor(97,99,99); 
doc.setTextColor(255,255,255);
doc.rect(totalsX, totalsY - 5, 74, 10, "F"); 

doc.text("Total:", totalsX + 2, totalsY);
doc.text(`LKR ${formatCurrency(finalAmount)}`, totalsX + 72, totalsY, { align: "right" }); // moved left

doc.setTextColor(0,0,0);


    // Cheque Payment
    let chequeY = Math.max(finalY + 25, totalsY + 10);
    doc.setFont("helvetica", "bold"); doc.setFontSize(12); doc.text("Cheque Payment", 15, chequeY);
    chequeY += 6; doc.setFont("helvetica", "normal"); doc.setFontSize(10);
    doc.text("Please make the cheque payable to: NMD Accountancy", 15, chequeY);

    // Footer
    let footerY = pageHeight - 20; doc.setFontSize(9); doc.setTextColor(85,85,85);
    doc.text("If you have any questions about this invoice, please contact nmdacc2018@gmail.com or 0777178196", pageWidth/2, footerY, { align: "center" });

    doc.save(`${inv.number}.pdf`);
}

function formatCurrency(num) {
    return Number(num).toLocaleString("en-US", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
}



// ------------------------------
// COLLAPSIBLE SIDEBAR
// ------------------------------
const sidebar = document.querySelector('.sidebar');
const toggleBtn = document.getElementById('sidebarToggle');
toggleBtn.addEventListener('click', ()=>{
    sidebar.classList.toggle('collapsed');
    toggleBtn.classList.toggle('collapsed');
});

// ------------------------------
// LIVE DATE/TIME
// ------------------------------
function updateDateTime(){
    const now = new Date();
    const options = { weekday:'short', year:'numeric', month:'short', day:'numeric', hour:'2-digit', minute:'2-digit', second:'2-digit' };
    document.getElementById('systemDateTime').textContent = now.toLocaleDateString('en-US', options);
}
setInterval(updateDateTime,1000);
updateDateTime();

// ------------------------------
// LOGOUT BUTTON
// ------------------------------
document.getElementById('navLogout').addEventListener('click', ()=>{
    localStorage.removeItem('isLoggedIn');
    localStorage.removeItem('userEmail');
    window.location.href = 'index.html';
});

// ------------------------------
// AUTO LOGOUT AFTER INACTIVITY
// ------------------------------
const AUTO_LOGOUT_TIME = 15*60*1000;
let logoutTimer;
function startLogoutTimer(){ logoutTimer = setTimeout(()=>{ alert("Logged out due to inactivity."); localStorage.removeItem('isLoggedIn'); localStorage.removeItem('userEmail'); window.location.href='index.html'; }, AUTO_LOGOUT_TIME); }
function resetLogoutTimer(){ clearTimeout(logoutTimer); startLogoutTimer(); }
document.addEventListener('mousemove', resetLogoutTimer);
document.addEventListener('keydown', resetLogoutTimer);
document.addEventListener('click', resetLogoutTimer);
startLogoutTimer();
</script>

</body>
</html>

